sudo: required

services:
  - docker

language: php

git:
  depth: 3

php:
  - '5.6'
  - '7.0'
  - '7.1'
  - '7.2'
  - '7.0snapshot'
  - '7.1snapshot'
  - '7.2snapshot'
  - 'master'

matrix:
  allow_failures:
    - php: 'master'

install:
  - echo "${TRAVIS_PHP_VERSION}"
  - if [[ "${TRAVIS_PHP_VERSION}" == "7.0snapshot" ]]; then composer update; fi
  - if [[ "${TRAVIS_PHP_VERSION}" == "7.0" ]]; then composer update; fi
  - if [[ "${TRAVIS_PHP_VERSION}" == "5.6" ]]; then composer require --dev phpunit/phpunit ^5 --update-with-dependencies --no-suggest; composer update --no-suggest; fi
  - composer install
  - bin/pipelines --images | while read -r image; do docker image pull "$image"; done; true;

script:
  - vendor/bin/phpunit tests
  - composer build
  - bin/pipelines --version
  - bin/pipelines
  - bin/pipelines --verbose --debug --show
  - bin/pipelines --pipeline custom/docker
  - bin/pipelines --pipeline custom/unit-tests
  - bin/pipelines --pipeline custom/lint-php-5.3
  - bin/pipelines --pipeline custom/unit-tests-php-5.3

notifications:
  email: false

deploy:
  provider: releases
  api_key:
    secure: 4xNiXhCoBqLy2CkocUjn2zPKFYr7xod3b02EQ0HG2qNPEJBt+DeZomcck7BsiMcbmbzfTy4vqHX+B5iWmiUMqniYiYwSs28TQYrj6mlY6nav6jfTAkQiLO2Wl/JbV/X1lLIFALGfWkbHgCpgqhF7aOTX9CazcAviqr3WD9CRctlibBTsSdyaBtG9tNrsbjlg4gY/DLBODD4vsbXWok1kXR7gQWy+DeXFvw5BAEOlmI8YP2mpByv7+iGuNSRXIP66xrrIP6OZWooSiNsiNTBcwmUwqu5Ax6QKnY+iWX7oXnzjUsW7JhHmh/dndK8+e/ejPQKjmqGNaJtRFIG+tHKq25Ql32yCmtXTPr1OcJSWtZLPrHLSlptjcVcjXUEoO28CDG3/+3ENcPp3lw3VqVwHb25ySJgLWusiINyYY9tsTZBzeIW5ez/NrPRkjPI8BmJbUSS2eopSPR93WkPF6FURnbLD+aWKPqV4Dj4wCZhldRt+gn0mNmSgm1b/YOUhnlKKctThujmobj5ymoHKQol2GlQwQhLc+J2qThSsw9CvtHUZ4ZXY/+ae/CSIZodcdyZD540YRJoamwiLxUragvOHkeuwjYCZWyw77gUc9jbZVXr8/SCHaA96pCRMwTWPDJYAKJ6jA7mUn9Xb7PxFJxWhFzwPKE8+JSkLTvWVa3JZ66Y=
  file: build/pipelines.phar
  on:
    condition: $TRAVIS_PHP_VERSION = 7.2
    tags: true
    repo: ktomk/pipelines
